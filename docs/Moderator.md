# ゲームの進行
## ルールの簡単な説明
推奨BGM: G線上のアリア BWV 1068（バッハ作曲、ウィルヘルミ編曲）

実際の盤面を使いつつルールの簡単な確認を行ってください。

## オープニング
推奨BGM: フーガ ト短調 BWV 578 （バッハ作曲）

[オープニング台本](resources/HandOuts/CommonHandOut.pdf#page=8)の読み合わせをお願いします。

## 調査・密談・全体会議
カード調査や会話を行うフェーズです。

PC番号順に、「誰が調査組（2人）に行き、誰が居残り組（3人）に残るか」を指名していきます。この時、全体会議（全員居残り組）を選ぶこともできます。指名された組み合わせに分かれて5分がすぎると、次のプレイヤーが組み合わせを指名します。条件を満たしたプレイヤー（カードを入手した、必要な情報を揃えた、など）が、追加情報を求めてきますので、[追加情報の管理](AdditionalInfos.md)を参考にしてください。


プレイヤー5人全員が指名を終えると（5分×5回 = 25分）、休憩5分間が入ります。この5分間はトイレ休憩のほか、追加ハンドアウトを読む時間を想定しています。GMの裁量で雑談禁止にしたり、短縮・延長したりしても問題ありません。また、情報量の多い追加ハンドアウトを渡した後は、GMと1分間程度の話す時間を設けることも検討してください。

25分間の調査・会話+5分間の休憩を1フェーズとして、4フェーズあります。

### 休憩
推奨BGM: ピアノソナタ8番 ハ短調 op.13「悲愴」第三楽章 （ベートーヴェン作曲）

追加情報を読み込む時間として頻回に休憩をとっています。

### 第1フェーズ
推奨BGM: 交響曲第3番 変ホ長調 作品55『英雄』（ベートーヴェン作曲）

> 調査・密談・全体会議フェーズでは5回、調査組と居残り組に分かれて5分間行動します。カード調査ができるのはこのうち調査組だけです。組みわけは、各プレイヤーが1回ずつ指名していきます。この際、自分ともう一人で調査組になってもいいですし、自分以外の2人を調査組に指名してもかまいません。また、全体会議を選ぶこともできますが、この場合カード調査を行うことはできません。

> では、カード調査の方法について説明します。盤面中央、「フーガの部屋」の一番左のカードをご覧ください。一番血まみれのカードです。下に星が二つ付いています。

> カード調査には調査ポイントを消費します。シンフォニー、カプリッチオ、自分のところに虫眼鏡のマーカーがあるのはわかりますか？　ではシンフォニー、先ほどの血まみれのカードの左下の星に、調査ポイントを移動してください。次にカプリッチオ、右の白と黄色の二重星に調査ポイントをおいてください。

> この状態は、シンフォニーが調査に協力して、カプリッチオが調査を完了した形になります。この場合、カードを見ることができるのはカプリッチオとシンフォニーです。見るときは自分だけ見る、で閲覧してください。

> 次にカードの所有と全体公開に関して説明します。現在、このカードを所有しているのはカプリッチオだけです。所有者であるカプリッチオはカードの効果の使用や譲渡ができます。また、このカードを全体公開することができるのはカプリッチオだけです。ではカプリッチオ、「カードを表にする」で全体公開してもらってもいいですか？　ありがとうございます。カードを全体公開すると、調査ポイントが1つだけ戻ってきます。シンフォニーとカプリッチオは調査ポイントを自分の手元に戻してください。また、カプリッチオは、横長でカプリッチオと書かれたマーカーを先ほど全体公開したカードの下に移動してください。これは、全体公開した後も、カプリッチオが所有者であることを示すためのマーカーです。

> 以上でカード調査の説明を修了します。何かご不明な点はありますか？

> でしたら、第1フェーズ開始します。

> 日の出頃の街はまだ青色で、外から聞こえるのは小鳥のさえずりだけである。重い口を最初に開いたのは、シンフォニーであった。

> シンフォニーさん、誰が調査組に行き、誰が居残り組に残るかを指名してください。全体会議を選ぶこともできます。

（以降、セレナーデ、ララバイ、キャロル、カプリッチオの順に指名していく）

### 第2フェーズ
推奨BGM: 24の奇想曲 第24番 イ短調 （パガニーニ作曲）

> 通勤中だろうか、隠れ家の外からは車の通る音がする。車道に差す朝日が、夜の冷え切った空気を少しずつ暖め始めていた。そこをもう一台車が通った。少しずつ活気を取り戻す朝の空気のなか、話し合いは熱を帯びていった。

> ルールは第1フェーズと同様です。シンフォニーさん、指名をお願いします。

### 第3フェーズ
推奨BGM: セレナード （シューベルト作曲）

> リビング・ダイニングを夕日が照らす。知りたいことも知りたくないことも知ってしまった。それでも、考え続けなければならないようだった。

> シンフォニーさん、指名をお願いします。

### 第4フェーズ
推奨BGM: コヴェントリー・キャロル　（作者不明）

> 調査・密談・全体会議ができる最後のフェーズです。この後は、推理、最終投票、エンディングのみとなっています。

> 第4フェーズに移る前に、調査ポイントと投票権の交換についてお話しします。ルールにも記載がありますが、調査ポイント4ptと1票を交換することができます。また、調査ポイントはエンディングでも使用価値があります。したがって、このフェーズではカードの全体公開や調査ポイントの譲渡も検討してください。

> 何か質問はありますか？

> 日は沈んだ。真相に近づきつつある一同は、あまり時間が残されていないことに気が付いていた。

> シンフォニーさん、指名をお願いします。

#### 第4フェーズ終了後

> 今、投票権と調査ポイントを交換したい、という人はいますか？

## 推理発表・投票
推奨BGM: カノン （パッヘルベル作曲）

> いまだ話したりない一同を、月明かりが急かす。もう時間はないのだ。

> ここで推理発表、投票とエンディングの仕組みを説明します。

> まず、プレイマットの右下、ロゴの上をご覧ください。

ここで、**犯人投票**と**リーダー投票**のカードを公開し、読み上げる。

> リーダーはリーダー権限により、カードを一枚強制的に奪うことができます。犯人は拘束されてしまい行動ができませんし、エンディングでカードが奪われそうになっても抵抗ができません。死亡した場合も同様です。

> 最終投票では**PC番号順**に**犯人として誰を拘束するべきか**を中心に話していただきます。リーダー投票に関しては話してはいけませんが、その他のことについては触れていただいてもかまいません。後から話す人は前に話した人へ反論してもかまいません。その後、各キャラクター用のテキストチャンネルに回答フォームを送りますので、記入をお願いします。

> 次は、エンディングについて解説します。エンディングでは行動順、というものがあり、物語に決着がつくまでターンを繰り返します。リーダーが最初、犯人が最後で、他の人は残存調査ポイント数が多い人の方が速いです。

> 以上で説明を終わりにします。何か、質問はありますか？

以下、卒業式のような厳粛さで、

> それでは、最終投票に移ります。PC番号1番、シンフォニー。推理をお願いします。

- 犯人投票とリーダー投票を行います。
- PC番号順に自分の犯人投票先の発表とその根拠を話していきます。
- 全員分の推理が終わったら、全員ミュートにするように促してください。
- 以下のボタンは投票先に加え、BONUS事項を記載したものがコピーできるボタンです。ご活用ください。

|キャラクター|BONUSミッション|コピー用ボタン|
|:-:|:-:|:-:|
|シンフォニー|図書館員殺人の犯人は誰ですか？（2点）|<button onclick="copyhidden('Symphony')">コピー</button>|
|セレナーデ|アオイは夏音で何をしていましたか？（2点）|<button onclick="copyhidden('Serenade')">コピー</button>|
|ララバイ|ほかの人は南西飛び地をどう思っていますか？（各0.5点）|<button onclick="copyhidden('Lullaby')">コピー</button>|
|キャロル||<button onclick="copyhidden('Carol')">コピー</button>|
|カプリッチオ|アリアは今、何をしていますか？（2点）|<button onclick="copyhidden('Capriccio')">コピー</button>|
<p></p>
 <div id="Symphony" hidden>シンフォニー</br>
1. 犯人投票は誰に入れますか？</br>
2. リーダー投票は誰に入れますか？</br>
3. BONUS: 図書館員殺人の犯人は誰ですか？（2点）</br>
（投票先は、先ほど発表した人間と別でも問題ありません）
</div>

 <div id="Serenade" hidden>セレナーデ</br>
1. 犯人投票は誰に入れますか？</br>
2. リーダー投票は誰に入れますか？</br>
3. BONUS: アオイは夏音で何をしていましたか？
</div>

 <div id="Lullaby" hidden>ララバイ</br>
1. 犯人投票は誰に入れますか？</br>
2. リーダー投票は誰に入れますか？</br>
3. BONUS: ほかの人は南西飛び地をどう思っていますか？
シンフォニー:</br>
セレナーデ:	</br>
キャロル:</br>
カプリッチオ:
</div>

 <div id="Carol" hidden>キャロル</br>
1. 犯人投票は誰に入れますか？</br>
2. リーダー投票は誰に入れますか？ 
</div>

 <div id="Capriccio" hidden>カプリッチオ</br>
1. 犯人投票は誰に入れますか？</br>
2. リーダー投票は誰に入れますか？ </br>
3. BONUS: アリアは今、何をしていますか？
</div>



<script>
function copyhidden(name){
  //create new div
  const hiddenDiv = document.getElementById(name);
  const newDiv = document.createElement("div");
  hiddenDiv.parentNode.insertBefore(newDiv, hiddenDiv.nextSibling);
  newDiv.innerHTML = hiddenDiv.innerHTML;
  let range = document.createRange();
  range.selectNodeContents(newDiv);

  //copy
  let selection = document.getSelection();
  selection.removeAllRanges();
  selection.addRange(range);

  document.execCommand('copy');
  selection.removeAllRanges();

  // delete new div
  newDiv.parentNode.removeChild(newDiv);
}
</script>

## エンディング
推奨BGM: 子守歌（シューベルト作曲）/ 旧支配者のキャロル

> 投票の集計が終わりました。先ほどお伝えした通り、エンディングの行動順はリーダーが最初、犯人が最後です。つきましては、結果発表に代えまして、行動順の発表を行います。

行動順を発表する。

> この行動順に沿って、皆さんは行動を何か一つとることができます。カードに書かれた効果を使ってもいいですし、カードに書かれていなくても、このアイテムならこんなことができそう、と提案してくださってもかまいません。手ごろなカードがなければ「他のプレイヤーを殴る」といった行動でもいいでしょう。また、他のプレイヤーから攻撃された場合は抵抗もできます。が、相手がアイテムの効果を使用している場合、抵抗は失敗することが多いでしょう。また、カードを奪うことも可能ですが、この時、調査ポイントを1ptだけ消費します。

> 今から数分間の選択一つひとつが、この物語の終わり方を左右します。よくよく考えて行動してください。

> 南の空高く、<ruby>橙<rp>（</rp><rt>だいだい</rt><rp>）</rp></ruby>色の星が<ruby>瞬<rp>（</rp><rt>またた</rt><rp>）</rp></ruby>いている。物語の行く末を見守るように。

> リーダーの○○、どういう行動を取りますか？

- 投票結果に応じて、プレイヤーが順番に行動します。
- 順番が来たプレイヤーは、「何らかの行動を1つ」とることができます。具体的な基準は示しませんが、あまりに複雑な行動は禁止してください。例えば「ほかのキャラクターを殺してアイテムを奪う」は1つですが、「そのアイテムを使う」までは別の行動とみなします。

エンディングで想定される行動とその帰結は「エンディングのイベント」を参照してください。

### エンディングの行動順

<div>1. リーダー（1回目）</div><div>
2~4. </div><div>
　A. リーダー、犯人は除外</div><div>
　B. 調査ポイントが多い順</div><div>
　C. PC番号順</div><div>
5. 犯人（拘束を他プレイヤーが解いた場合のみ行動できる）</div>
<p></p>

以降、繰り返し。

### 行動順計算ツール

半角数字で入力してください。雑に作っているので、それ以外の数字を入れると容易にバグります。

<script src="https://cdn.jsdelivr.net/npm/vue"></script>

<!-- いつか配列を使う -->

<table id="pts_table" class="padless_table">
  <thead>
  <tr>
    <th>投票者</th>
    <th>シンフォニー</th>
    <th>セレナーデ</th>
    <th>ララバイ</th>
    <th>キャロル</th>
    <th>カプリッチオ</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>残りポイント</td>
    <td><input size="10" v-model='pts_1'></td>
    <td><input size="10" v-model='pts_2'></td>
    <td><input size="10" v-model='pts_3'></td>
    <td><input size="10" v-model='pts_4'></td>
    <td><input size="10" v-model='pts_5'></td>
  </tr>
  </tbody>
</table>

<p></p>

<table id="mur_table" class="padless_table">
  <thead>
  <tr>
    <th>投票者</th>
    <th>使用票数</th>
    <th colspan="5">犯人投票先</th>
  </tr>
  </thead>

  <tbody>
   <tr>
    <td></td>
    <td></td>
    <td>シンフォニー</td>
    <td>セレナーデ</td>
    <td>ララバイ</td>
    <td>キャロル</td>
    <td>カプリッチオ</td>
  </tr>
  <tr>
    <td>シンフォニー</td>
    <td>{{mur_own_1}}</td>
    <td><input size="10" v-model='mur_1_1'></td>
    <td><input size="10" v-model='mur_1_2'></td>
    <td><input size="10" v-model='mur_1_3'></td>
    <td><input size="10" v-model='mur_1_4'></td>
    <td><input size="10" v-model='mur_1_5'></td>
  </tr>
  <tr>
    <td>セレナーデ</td>
    <td>{{mur_own_2}}</td>
    <td><input size="10" v-model='mur_2_1'></td>
    <td><input size="10" v-model='mur_2_2'></td>
    <td><input size="10" v-model='mur_2_3'></td>
    <td><input size="10" v-model='mur_2_4'></td>
    <td><input size="10" v-model='mur_2_5'></td>
  </tr>
  <tr>
    <td>ララバイ</td>
    <td>{{mur_own_3}}</td>
    <td><input size="10" v-model='mur_3_1'></td>
    <td><input size="10" v-model='mur_3_2'></td>
    <td><input size="10" v-model='mur_3_3'></td>
    <td><input size="10" v-model='mur_3_4'></td>
    <td><input size="10" v-model='mur_3_5'></td>
  </tr>
  <tr>
    <td>キャロル</td>
    <td>{{mur_own_4}}</td>
    <td><input size="10" v-model='mur_4_1'></td>
    <td><input size="10" v-model='mur_4_2'></td>
    <td><input size="10" v-model='mur_4_3'></td>
    <td><input size="10" v-model='mur_4_4'></td>
    <td><input size="10" v-model='mur_4_5'></td>
  </tr>
  <tr>
    <td>カプリッチオ</td>
    <td>{{mur_own_5}}</td>
    <td><input size="10" v-model='mur_5_1'></td>
    <td><input size="10" v-model='mur_5_2'></td>
    <td><input size="10" v-model='mur_5_3'></td>
    <td><input size="10" v-model='mur_5_4'></td>
    <td><input size="10" v-model='mur_5_5'></td>
  </tr>
  <tr>
    <td>得票</td>
    <td></td>
    <td>{{mur_1}}</td>
    <td>{{mur_2}}</td>
    <td>{{mur_3}}</td>
    <td>{{mur_4}}</td>
    <td>{{mur_5}}</td>
  </tr>
  <tr>
    <td>得pt</td>
    <td></td>
    <td>{{mur_pt_1}}</td>
    <td>{{mur_pt_2}}</td>
    <td>{{mur_pt_3}}</td>
    <td>{{mur_pt_4}}</td>
    <td>{{mur_pt_5}}</td>
  </tr>
  </tbody>
</table>
<p></p>


<table id="ldr_table" class="padless_table">
  <thead>
  <tr>
    <th>投票者</th>
    <th>使用票数</th>
    <th colspan="5">リーダー投票先</th>
  </tr>
  </thead>
  <tbody>
     <tr>
    <td></td>
    <td></td>
    <td>シンフォニー</td>
    <td>セレナーデ</td>
    <td>ララバイ</td>
    <td>キャロル</td>
    <td>カプリッチオ</td>
  </tr>
  <tr>
    <td>シンフォニー</td>
    <td>{{ldr_own_1}}</td>
    <td><input size="10" v-model='ldr_1_1'></td>
    <td><input size="10" v-model='ldr_1_2'></td>
    <td><input size="10" v-model='ldr_1_3'></td>
    <td><input size="10" v-model='ldr_1_4'></td>
    <td><input size="10" v-model='ldr_1_5'></td>
  </tr>
  <tr>
    <td>セレナーデ</td>
    <td>{{ldr_own_2}}</td>
    <td><input size="10" v-model='ldr_2_1'></td>
    <td><input size="10" v-model='ldr_2_2'></td>
    <td><input size="10" v-model='ldr_2_3'></td>
    <td><input size="10" v-model='ldr_2_4'></td>
    <td><input size="10" v-model='ldr_2_5'></td>
  </tr>
  <tr>
    <td>ララバイ</td>
    <td>{{ldr_own_3}}</td>
    <td><input size="10" v-model='ldr_3_1'></td>
    <td><input size="10" v-model='ldr_3_2'></td>
    <td><input size="10" v-model='ldr_3_3'></td>
    <td><input size="10" v-model='ldr_3_4'></td>
    <td><input size="10" v-model='ldr_3_5'></td>
  </tr>
  <tr>
    <td>キャロル</td>
    <td>{{ldr_own_4}}</td>
    <td><input size="10" v-model='ldr_4_1'></td>
    <td><input size="10" v-model='ldr_4_2'></td>
    <td><input size="10" v-model='ldr_4_3'></td>
    <td><input size="10" v-model='ldr_4_4'></td>
    <td><input size="10" v-model='ldr_4_5'></td>
  </tr>
  <tr>
    <td>カプリッチオ</td>
    <td>{{ldr_own_5}}</td>
    <td><input size="10" v-model='ldr_5_1'></td>
    <td><input size="10" v-model='ldr_5_2'></td>
    <td><input size="10" v-model='ldr_5_3'></td>
    <td><input size="10" v-model='ldr_5_4'></td>
    <td><input size="10" v-model='ldr_5_5'></td>
  </tr>
    <tr>
    <td>得票</td>
    <td></td>
    <td>{{ldr_1}}</td>
    <td>{{ldr_2}}</td>
    <td>{{ldr_3}}</td>
    <td>{{ldr_4}}</td>
    <td>{{ldr_5}}</td>
  </tr>
  <tr>
    <td>得pt</td>
    <td></td>
    <td>{{ldr_pt_1}}</td>
    <td>{{ldr_pt_2}}</td>
    <td>{{ldr_pt_3}}</td>
    <td>{{ldr_pt_4}}</td>
    <td>{{ldr_pt_5}}</td>
  </tr>
  </tbody>
</table>

<p></p>

<table id="odr_table">
  <thead>
  <tr>
    <th>行動順</th>
    <th>キャラクター</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>リーダー</td>
    <td>{{chrs[0]}}</td>
  </tr>
  <tr>
    <td>2</td>
    <td>{{chrs[1]}}</td>
  </tr>
  <tr>
    <td>3</td>
    <td>{{chrs[2]}}</td>
  </tr>
  <tr>
    <td>4</td>
    <td>{{chrs[3]}}</td>
  </tr>
  <tr>
    <td>犯人</td>
    <td>{{chrs[4]}}</td>
  </tr>
  </tbody>
</table>


<script>
const pts_table = new Vue({
  el: "#pts_table",
  data: {
  pts_1: 0, pts_2: 0, pts_3: 0, pts_4: 0, pts_5: 0,}
})

const mur_table = new Vue({
  el: "#mur_table",
  data: {
  mur_1_1: 0, mur_1_2: 0, mur_1_3: 0, mur_1_4: 0, mur_1_5: 0, 
  mur_2_1: 0, mur_2_2: 0, mur_2_3: 0, mur_2_4: 0, mur_2_5: 0, 
  mur_3_1: 0, mur_3_2: 0, mur_3_3: 0, mur_3_4: 0, mur_3_5: 0, 
  mur_4_1: 0, mur_4_2: 0, mur_4_3: 0, mur_4_4: 0, mur_4_5: 0, 
  mur_5_1: 0, mur_5_2: 0, mur_5_3: 0, mur_5_4: 0, mur_5_5: 0, 
  },
  computed: {
    mur_1: function(){return Number(this.mur_1_1) + Number(this.mur_2_1) + Number(this.mur_3_1) + Number(this.mur_4_1) + Number(this.mur_5_1)},
    mur_2: function(){return Number(this.mur_1_2) + Number(this.mur_2_2) + Number(this.mur_3_2) + Number(this.mur_4_2) + Number(this.mur_5_2)},
    mur_3: function(){return Number(this.mur_1_3) + Number(this.mur_2_3) + Number(this.mur_3_3) + Number(this.mur_4_3) + Number(this.mur_5_3)},
    mur_4: function(){return Number(this.mur_1_4) + Number(this.mur_2_4) + Number(this.mur_3_4) + Number(this.mur_4_4) + Number(this.mur_5_4)},
    mur_5: function(){return Number(this.mur_1_5) + Number(this.mur_2_5) + Number(this.mur_3_5) + Number(this.mur_4_5) + Number(this.mur_5_5)},
    mur_pt_1: function(){return Number(this.mur_1_1*pts_table.pts_1) + Number(this.mur_2_1*pts_table.pts_2) + Number(this.mur_3_1*pts_table.pts_3) + Number(this.mur_4_1*pts_table.pts_4) + Number(this.mur_5_1*pts_table.pts_5)},
    mur_pt_2: function(){return Number(this.mur_1_2*pts_table.pts_1) + Number(this.mur_2_2*pts_table.pts_2) + Number(this.mur_3_2*pts_table.pts_3) + Number(this.mur_4_2*pts_table.pts_4) + Number(this.mur_5_2*pts_table.pts_5)},
    mur_pt_3: function(){return Number(this.mur_1_3*pts_table.pts_1) + Number(this.mur_2_3*pts_table.pts_2) + Number(this.mur_3_3*pts_table.pts_3) + Number(this.mur_4_3*pts_table.pts_4) + Number(this.mur_5_3*pts_table.pts_5)},
    mur_pt_4: function(){return Number(this.mur_1_4*pts_table.pts_1) + Number(this.mur_2_4*pts_table.pts_2) + Number(this.mur_3_4*pts_table.pts_3) + Number(this.mur_4_4*pts_table.pts_4) + Number(this.mur_5_4*pts_table.pts_5)},
    mur_pt_5: function(){return Number(this.mur_1_5*pts_table.pts_1) + Number(this.mur_2_5*pts_table.pts_2) + Number(this.mur_3_5*pts_table.pts_3) + Number(this.mur_4_5*pts_table.pts_4) + Number(this.mur_5_5*pts_table.pts_5)},
    mur_own_1: function(){return Number(this.mur_1_1) + Number(this.mur_1_2) + Number(this.mur_1_3) + Number(this.mur_1_4) + Number(this.mur_1_5)},
    mur_own_2: function(){return Number(this.mur_2_1) + Number(this.mur_2_2) + Number(this.mur_2_3) + Number(this.mur_2_4) + Number(this.mur_2_5)},
    mur_own_3: function(){return Number(this.mur_3_1) + Number(this.mur_3_2) + Number(this.mur_3_3) + Number(this.mur_3_4) + Number(this.mur_3_5)},
    mur_own_4: function(){return Number(this.mur_4_1) + Number(this.mur_4_2) + Number(this.mur_4_3) + Number(this.mur_4_4) + Number(this.mur_4_5)},
    mur_own_5: function(){return Number(this.mur_5_1) + Number(this.mur_5_2) + Number(this.mur_5_3) + Number(this.mur_5_4) + Number(this.mur_5_5)
    
    }, 
  }
})

const ldr_table = new Vue({
  el: "#ldr_table",
  data: {
  ldr_1_1: 0, ldr_1_2: 0, ldr_1_3: 0, ldr_1_4: 0, ldr_1_5: 0,
  ldr_2_1: 0, ldr_2_2: 0, ldr_2_3: 0, ldr_2_4: 0, ldr_2_5: 0,
  ldr_3_1: 0, ldr_3_2: 0, ldr_3_3: 0, ldr_3_4: 0, ldr_3_5: 0,
  ldr_4_1: 0, ldr_4_2: 0, ldr_4_3: 0, ldr_4_4: 0, ldr_4_5: 0,
  ldr_5_1: 0, ldr_5_2: 0, ldr_5_3: 0, ldr_5_4: 0, ldr_5_5: 0,
  },
  computed: {
    ldr_1: function(){return Number(this.ldr_1_1) + Number(this.ldr_2_1) + Number(this.ldr_3_1) + Number(this.ldr_4_1) + Number(this.ldr_5_1)},
    ldr_2: function(){return Number(this.ldr_1_2) + Number(this.ldr_2_2) + Number(this.ldr_3_2) + Number(this.ldr_4_2) + Number(this.ldr_5_2)},
    ldr_3: function(){return Number(this.ldr_1_3) + Number(this.ldr_2_3) + Number(this.ldr_3_3) + Number(this.ldr_4_3) + Number(this.ldr_5_3)},
    ldr_4: function(){return Number(this.ldr_1_4) + Number(this.ldr_2_4) + Number(this.ldr_3_4) + Number(this.ldr_4_4) + Number(this.ldr_5_4)},
    ldr_5: function(){return Number(this.ldr_1_5) + Number(this.ldr_2_5) + Number(this.ldr_3_5) + Number(this.ldr_4_5) + Number(this.ldr_5_5)},
    ldr_pt_1: function(){return Number(this.ldr_1_1*pts_table.pts_1) + Number(this.ldr_2_1*pts_table.pts_2) + Number(this.ldr_3_1*pts_table.pts_3) + Number(this.ldr_4_1*pts_table.pts_4) + Number(this.ldr_5_1*pts_table.pts_5)},
    ldr_pt_2: function(){return Number(this.ldr_1_2*pts_table.pts_1) + Number(this.ldr_2_2*pts_table.pts_2) + Number(this.ldr_3_2*pts_table.pts_3) + Number(this.ldr_4_2*pts_table.pts_4) + Number(this.ldr_5_2*pts_table.pts_5)},
    ldr_pt_3: function(){return Number(this.ldr_1_3*pts_table.pts_1) + Number(this.ldr_2_3*pts_table.pts_2) + Number(this.ldr_3_3*pts_table.pts_3) + Number(this.ldr_4_3*pts_table.pts_4) + Number(this.ldr_5_3*pts_table.pts_5)},
    ldr_pt_4: function(){return Number(this.ldr_1_4*pts_table.pts_1) + Number(this.ldr_2_4*pts_table.pts_2) + Number(this.ldr_3_4*pts_table.pts_3) + Number(this.ldr_4_4*pts_table.pts_4) + Number(this.ldr_5_4*pts_table.pts_5)},
    ldr_pt_5: function(){return Number(this.ldr_1_5*pts_table.pts_1) + Number(this.ldr_2_5*pts_table.pts_2) + Number(this.ldr_3_5*pts_table.pts_3) + Number(this.ldr_4_5*pts_table.pts_4) + Number(this.ldr_5_5*pts_table.pts_5)},
    ldr_own_1: function(){return Number(this.ldr_1_1) + Number(this.ldr_1_2) + Number(this.ldr_1_3) + Number(this.ldr_1_4) + Number(this.ldr_1_5)},
    ldr_own_2: function(){return Number(this.ldr_2_1) + Number(this.ldr_2_2) + Number(this.ldr_2_3) + Number(this.ldr_2_4) + Number(this.ldr_2_5)},
    ldr_own_3: function(){return Number(this.ldr_3_1) + Number(this.ldr_3_2) + Number(this.ldr_3_3) + Number(this.ldr_3_4) + Number(this.ldr_3_5)},
    ldr_own_4: function(){return Number(this.ldr_4_1) + Number(this.ldr_4_2) + Number(this.ldr_4_3) + Number(this.ldr_4_4) + Number(this.ldr_4_5)},
    ldr_own_5: function(){return Number(this.ldr_5_1) + Number(this.ldr_5_2) + Number(this.ldr_5_3) + Number(this.ldr_5_4) + Number(this.ldr_5_5)}, 
  }
})

function pick_maxs(chr_votes){
  var result = [];
  var max_vote = Math.max.apply(null, chr_votes)
  for (let i = 0; i < chr_votes.length; i++){
     if (chr_votes[i] == max_vote) result.push(i);
  }
  return [max_vote, result]
}

var chr_name = {
  1: "シンフォニー",
  2: "セレナーデ",
  3: "ララバイ",
  4: "キャロル",
  5: "カプリッチオ", 
  }

function val_chr(a){
  return a[0]*10000 + a[1]*1000 - a[2] * 100 - a[3]*10 + a[4]
}

function sort_chr(a, b){
  return val_chr(b)-val_chr(a)
}

function sort_dict_keys(dict){
  var array = Object.keys(dict).map((k)=>({ key: k, value: dict[k] }));

  array.sort((a, b) => b.value - a.value);

return array.map(k=>k.key)
}

function calc_order(){
  var mur_chr = "";
  var ldr_chr = "";
  var mur_order = [
    [+mur_table.mur_1, -pts_table.pts_1, +mur_table.mur_pt_1, 1, 0],
    [+mur_table.mur_2, -pts_table.pts_2, +mur_table.mur_pt_2, 2, 0],
    [+mur_table.mur_3, -pts_table.pts_3, +mur_table.mur_pt_3, 3, 0],
    [+mur_table.mur_4, -pts_table.pts_4, +mur_table.mur_pt_4, 4, 0],
    [+mur_table.mur_5, -pts_table.pts_5, +mur_table.mur_pt_5, 5, 0],
  ];
  var ldr_order = [
    [+ldr_table.ldr_1, +pts_table.pts_1, +ldr_table.ldr_pt_1, 1, 1],
    [+ldr_table.ldr_2, +pts_table.pts_2, +ldr_table.ldr_pt_2, 2, 1],
    [+ldr_table.ldr_3, +pts_table.pts_3, +ldr_table.ldr_pt_3, 3, 1],
    [+ldr_table.ldr_4, +pts_table.pts_4, +ldr_table.ldr_pt_4, 4, 1],
    [+ldr_table.ldr_5, +pts_table.pts_5, +ldr_table.ldr_pt_5, 5, 1],
  ];
  var sorted_ = mur_order.concat(ldr_order).sort(sort_chr)
  var first_ele = sorted_[0]
  if (first_ele[3] == 0){
    mur_chr = first_ele[3];
    ldr_order.splice(mur_chr-1, 1)
    ldr_chr = ldr_order.sort(sort_chr)[0][3];
  }else{
    ldr_chr = first_ele[3];
    mur_order.splice(ldr_chr-1, 1)
    mur_chr = mur_order.sort(sort_chr)[0][3];
  }
  var other_chr = {1: pts_table.pts_1, 2: pts_table.pts_2, 3: pts_table.pts_3, 4: pts_table.pts_4, 5: pts_table.pts_5};
  delete other_chr[mur_chr]
  delete other_chr[ldr_chr]
  var other_chr_sorted_arr = sort_dict_keys(other_chr).map(k=>chr_name[k])
  
  


  return [chr_name[ldr_chr]].concat(other_chr_sorted_arr).concat([chr_name[mur_chr]])
}

const odr_table = new Vue({
  el: "#odr_table",
  computed: {
    chrs: calc_order
  },
})


</script>
